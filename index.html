<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XPAIO - Official Pi App</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'Malgun Gothic', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .container { background: #161b22; padding: 2.5rem; border-radius: 16px; text-align: center; box-shadow: 0 8px 32px rgba(0,0,0,0.6); border: 1px solid #30363d; }
        .pay-btn { background-color: #6200ee; color: white; border: none; padding: 15px 30px; font-size: 1.2rem; font-weight: bold; border-radius: 10px; cursor: pointer; margin-top: 25px; transition: transform 0.2s, background 0.3s; }
        .pay-btn:hover { background-color: #3700b3; transform: scale(1.05); }
        #status { margin-top: 20px; font-size: 1rem; color: #58a6ff; font-weight: 500; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="color: #f0f6fc;">XPAIO Ecosystem</h1>
        <div id="status">파이 네트워크와 보안 연결 중...</div>
        
        <button id="pay-button" class="pay-btn" onclick="startPayment()" style="display:none;">
            테스트 결제 (0.1 Pi) 시도
        </button>
    </div>

    <script>
        const Pi = window.Pi;

        async function initPi() {
            try {
                // [리더님 필독] 샌드박스 코드 입력 단계에서는 반드시 sandbox: true여야 연결이 뚫립니다.
                await Pi.init({ version: "2.0", sandbox: true });
                
                // 파이오니어 인증
                const auth = await Pi.authenticate(['payments', 'username'], (payment) => {
                    console.log("미완료 결제건 발견:", payment);
                });
                
                document.getElementById("status").innerText = auth.user.username + " 리더님, 인증 성공!";
                document.getElementById("pay-button").style.display = "inline-block";
                
            } catch (err) {
                console.error("인증 실패:", err);
                document.getElementById("status").innerText = "연결 대기 중: " + (err.message || "샌드박스 코드를 다시 확인하세요.");
            }
        }

        async function startPayment() {
            try {
                await Pi.createPayment({
                    amount: 0.1,
                    memo: "XPAIO 10단계 최종 검증 결제",
                    metadata: { orderId: "XPAIO_" + Date.now() },
                }, {
                    onReadyForServerApproval: async (paymentId) => {
                        console.log("승인 요청:", paymentId);
                        return true; // 프론트엔드 즉시 승인
                    },
                    onReadyForServerCompletion: async (paymentId, txid) => {
                        alert("결제 성공! 트랜잭션 ID: " + txid);
                        document.getElementById("status").innerText = "결제 완료! 10단계를 통과하셨습니다.";
                    },
                    onCancel: () => alert("결제를 취소하셨습니다."),
                    onError: (err) => alert("결제 에러: " + err.message)
                });
            } catch (err) {
                console.error("결제 프로세스 실패:", err);
            }
        }

        window.onload = initPi;
    </script>
</body>
</html>